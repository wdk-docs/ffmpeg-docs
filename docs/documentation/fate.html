

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>FFmpeg Automated Testing Environment &mdash; ffmpeg-docs v2019.06.09 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="author" title="关于这些文档" href="../about.html" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="下载FFmpeg" href="../download.html" />
    <link rel="prev" title="Using Git to develop FFmpeg" href="git-howto.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../contents.html" class="icon icon-home"> ffmpeg-docs
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">FFmpeg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about.html">关于FFmpeg</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">文档</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#command-line-tools-documentation">Command Line Tools Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#components-documentation">Components Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#libraries-documentation">Libraries Documentation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#general-documentation">General Documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="faq.html">FFmpeg FAQ</a></li>
<li class="toctree-l3"><a class="reference internal" href="general.html">General Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="platform.html">Platform Specific Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="git-howto.html">Using Git to develop FFmpeg</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">FFmpeg Automated Testing Environment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#api-documentation">API Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#community-contributed-documentation">Community Contributed Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#books-about-ffmpeg">Books about FFmpeg</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../download.html">下载FFmpeg</a></li>
<li class="toctree-l1"><a class="reference internal" href="../news.html">新闻</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact.html">联系我们</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bugreports.html">错误报告</a></li>
<li class="toctree-l1"><a class="reference internal" href="../wiki.html">欢迎来到FFmpeg Bug Tracker和Wiki</a></li>
<li class="toctree-l1"><a class="reference internal" href="../donations.html">捐赠</a></li>
<li class="toctree-l1"><a class="reference internal" href="../consulting.html">与FFmpeg相关的咨询和就业机会</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">FFmpeg安全</a></li>
<li class="toctree-l1"><a class="reference internal" href="../legal.html">FFmpeg许可和法律注意事项</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../contents.html">ffmpeg-docs</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../contents.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">文档</a> &raquo;</li>
        
      <li>FFmpeg Automated Testing Environment</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/documentation/fate.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ffmpeg-automated-testing-environment">
<h1>FFmpeg Automated Testing Environment<a class="headerlink" href="#ffmpeg-automated-testing-environment" title="永久链接至标题">¶</a></h1>
<p>Table of Contents
1 Introduction
2 Using FATE from your FFmpeg source directory
3 Submitting the results to the FFmpeg result aggregation server
4 Uploading new samples to the fate suite
5 FATE makefile targets and variables
5.1 Makefile targets
5.2 Makefile variables
5.3 Examples
1 Introduction
FATE is an extended regression suite on the client-side and a means for results aggregation and presentation on the server-side.</p>
<p>The first part of this document explains how you can use FATE from your FFmpeg source directory to test your ffmpeg binary. The second part describes how you can run FATE to submit the results to FFmpeg’s FATE server.</p>
<p>In any way you can have a look at the publicly viewable FATE results by visiting this website:</p>
<p><a class="reference external" href="http://fate.ffmpeg.org/">http://fate.ffmpeg.org/</a></p>
<p>This is especially recommended for all people contributing source code to FFmpeg, as it can be seen if some test on some platform broke with their recent contribution. This usually happens on the platforms the developers could not test on.</p>
<p>The second part of this document describes how you can run FATE to submit your results to FFmpeg’s FATE server. If you want to submit your results be sure to check that your combination of CPU, OS and compiler is not already listed on the above mentioned website.</p>
<p>In the third part you can find a comprehensive listing of FATE makefile targets and variables.</p>
<p>2 Using FATE from your FFmpeg source directory
If you want to run FATE on your machine you need to have the samples in place. You can get the samples via the build target fate-rsync. Use this command from the top-level source directory:</p>
<p>make fate-rsync SAMPLES=fate-suite/
make fate       SAMPLES=fate-suite/
The above commands set the samples location by passing a makefile variable via command line. It is also possible to set the samples location at source configuration time by invoking configure with –samples=&lt;path to the samples directory&gt;. Afterwards you can invoke the makefile targets without setting the SAMPLES makefile variable. This is illustrated by the following commands:</p>
<p>./configure –samples=fate-suite/
make fate-rsync
make fate
Yet another way to tell FATE about the location of the sample directory is by making sure the environment variable FATE_SAMPLES contains the path to your samples directory. This can be achieved by e.g. putting that variable in your shell profile or by setting it in your interactive session.</p>
<p>FATE_SAMPLES=fate-suite/ make fate
Do not put a ’~’ character in the samples path to indicate a home directory. Because of shell nuances, this will cause FATE to fail.</p>
<p>To use a custom wrapper to run the test, pass –target-exec to configure or set the TARGET_EXEC Make variable.</p>
<p>3 Submitting the results to the FFmpeg result aggregation server
To submit your results to the server you should run fate through the shell script tests/fate.sh from the FFmpeg sources. This script needs to be invoked with a configuration file as its first argument.</p>
<p>tests/fate.sh /path/to/fate_config
A configuration file template with comments describing the individual configuration variables can be found at doc/fate_config.sh.template.</p>
<p>The mentioned configuration template is also available here:</p>
<p>slot=                                    # some unique identifier
repo=git://source.ffmpeg.org/ffmpeg.git  # the source repository
#branch=release/2.6                       # the branch to test
samples=                                 # path to samples directory
workdir=                                 # directory in which to do all the work
#fate_recv=”ssh -T <a class="reference external" href="mailto:fate&#37;&#52;&#48;fate&#46;ffmpeg&#46;org">fate<span>&#64;</span>fate<span>&#46;</span>ffmpeg<span>&#46;</span>org</a>” # command to submit report
comment=                                 # optional description
build_only=     # set to “yes” for a compile-only instance that skips tests
ignore_tests=</p>
<p># the following are optional and map to configure options
arch=
cpu=
cross_prefix=
as=
cc=
ld=
target_os=
sysroot=
target_exec=
target_path=
target_samples=
extra_cflags=
extra_ldflags=
extra_libs=
extra_conf=     # extra configure options not covered above</p>
<p>#make=          # name of GNU make if not ‘make’
makeopts=       # extra options passed to ‘make’
#makeopts_fate= # extra options passed to ‘make’ when running tests,</p>
<blockquote>
<div><p># defaulting to makeopts above if this is not set</p>
</div></blockquote>
<dl class="simple">
<dt>#tar=           # command to create a tar archive from its arguments on stdout,</dt><dd><p># defaults to ‘tar c’</p>
</dd>
</dl>
<p>Create a configuration that suits your needs, based on the configuration template. The slot configuration variable can be any string that is not yet used, but it is suggested that you name it adhering to the following pattern ‘arch-os-compiler-compiler version’. The configuration file itself will be sourced in a shell script, therefore all shell features may be used. This enables you to setup the environment as you need it for your build.</p>
<p>For your first test runs the fate_recv variable should be empty or commented out. This will run everything as normal except that it will omit the submission of the results to the server. The following files should be present in $workdir as specified in the configuration file:</p>
<p>configure.log
compile.log
test.log
report
version
When you have everything working properly you can create an SSH key pair and send the public key to the FATE server administrator who can be contacted at the email address <a class="reference external" href="mailto:fate-admin&#37;&#52;&#48;ffmpeg&#46;org">fate-admin<span>&#64;</span>ffmpeg<span>&#46;</span>org</a>.</p>
<p>Configure your SSH client to use public key authentication with that key when connecting to the FATE server. Also do not forget to check the identity of the server and to accept its host key. This can usually be achieved by running your SSH client manually and killing it after you accepted the key. The FATE server’s fingerprint is:</p>
<p>‘RSA’
d3:f1:83:97:a4:75:2b:a6:fb:d6:e8:aa:81:93:97:51</p>
<p>‘ECDSA’
76:9f:68:32:04:1e:d5:d4:ec:47:3f:dc:fc:18:17:86</p>
<p>If you have problems connecting to the FATE server, it may help to try out the ssh command with one or more -v options. You should get detailed output concerning your SSH configuration and the authentication process.</p>
<p>The only thing left is to automate the execution of the fate.sh script and the synchronisation of the samples directory.</p>
<p>4 Uploading new samples to the fate suite
This is for developers who have an account on the fate suite server. If you upload new samples, please make sure they are as small as possible, space on each client, network bandwidth and so on benefit from smaller test cases. Also keep in mind older checkouts use existing sample files, that means in practice generally do not replace, remove or overwrite files as it likely would break older checkouts or releases. Also all needed samples for a commit should be uploaded, ideally 24 hours, before the push.</p>
<p>#First update your local samples copy:
rsync -vauL –chmod=Dg+s,Duo+x,ug+rw,o+r,o-w,+X fate-suite.ffmpeg.org:/home/samples/fate-suite/ ~/fate-suite</p>
<p>#Then do a dry run checking what would be uploaded:
rsync -vanL –no-g –chmod=Dg+s,Duo+x,ug+rw,o+r,o-w,+X ~/fate-suite/ fate-suite.ffmpeg.org:/home/samples/fate-suite</p>
<p>#Upload the files:
rsync -vaL  –no-g –chmod=Dg+s,Duo+x,ug+rw,o+r,o-w,+X ~/fate-suite/ fate-suite.ffmpeg.org:/home/samples/fate-suite
5 FATE makefile targets and variables
5.1 Makefile targets
fate-rsync
Download/synchronize sample files to the configured samples directory.</p>
<p>fate-list
Will list all fate/regression test targets.</p>
<p>fate
Run the FATE test suite (requires the fate-suite dataset).</p>
<p>5.2 Makefile variables
V
Verbosity level, can be set to 0, 1 or 2.</p>
<p>0: show just the test arguments
1: show just the command used in the test
2: show everything
SAMPLES
Specify or override the path to the FATE samples at make time, it has a meaning only while running the regression tests.</p>
<p>THREADS
Specify how many threads to use while running regression tests, it is quite useful to detect thread-related regressions.</p>
<p>THREAD_TYPE
Specify which threading strategy test, either ‘slice’ or ‘frame’, by default ‘slice+frame’</p>
<p>CPUFLAGS
Specify CPU flags.</p>
<p>TARGET_EXEC
Specify or override the wrapper used to run the tests. The TARGET_EXEC option provides a way to run FATE wrapped in valgrind, qemu-user or wine or on remote targets through ssh.</p>
<p>GEN
Set to ‘1’ to generate the missing or mismatched references.</p>
<p>HWACCEL
Specify which hardware acceleration to use while running regression tests, by default ‘none’ is used.</p>
<p>KEEP
Set to ‘1’ to keep temp files generated by fate test(s) when test is successful. Default is ‘0’, which removes these files. Files are always kept when a test fails.</p>
<p>5.3 Examples
make V=1 SAMPLES=/var/fate/samples THREADS=2 CPUFLAGS=mmx fate
This document was generated on June 11, 2019 using makeinfo.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../download.html" class="btn btn-neutral float-right" title="下载FFmpeg" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="git-howto.html" class="btn btn-neutral float-left" title="Using Git to develop FFmpeg" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, BandCap

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>